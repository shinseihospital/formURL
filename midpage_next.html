<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>次ページ確認中</title>
  <script>
    const endFormUrl = "https://docs.google.com/forms/d/1mFYoCLTJw5MB2oF3vEUyVh3oyOgY2X7dcySd_KaxTnM/viewform";
    const nextPageUrl = "https://docs.google.com/forms/d/e/1FAIpQLSc3ozZXzSJbRDiZEJme54Hh23Ae-lRoIm9PKGNf0HmgWVZhGQ/viewform?pli=1&edit2=2_ABaOnud82XXXXXXX#responses"; // ←3ページ目のURLに変えてください
    const countApiUrl = "https://script.google.com/macros/s/AKfycbykAh_mcvSYotlgdKHJjCa9q19p6jYJEuTh3dwOGGK3MfWYy49oguYQzFGMCyUaznNQ/exec";

    async function checkAndRedirect() {
      document.getElementById("status").textContent = "回答数を確認中です…";
      try {
        const res = await fetch(countApiUrl);
        const data = await res.json();

        let redirectUrl = data.count >= 3 ? endFormUrl : nextPageUrl;
        setTimeout(() => {
          window.location.href = redirectUrl;
        }, 2000);
      } catch (e) {
        document.getElementById("status").textContent = "エラーが発生しました。再読み込みしてください。";
      }
    }

    window.addEventListener('DOMContentLoaded', checkAndRedirect);
  </script>
</head>
<body>
  <h1>次ページに移動します</h1>
  <p id="status">確認中です…</p>
</body>
</html>
